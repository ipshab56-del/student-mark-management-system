<div class="p-8 space-y-8" style="margin: 0 !important; padding: 2rem !important; width: 100vw !important; max-width: none !important;">
  <h1 class="text-4xl font-bold text-center mb-8">ğŸ“Š Complete Report</h1>

  <!-- Combined Data Table -->
  <div class="table-section" style="width: 100% !important;">
    <h2 class="text-2xl font-bold mb-4">Student Academic Report</h2>
    <div class="table-container" style="width: 100% !important; max-width: none !important; overflow-x: auto !important;">
      <table class="table" style="min-width: 2000px !important; width: 100% !important;">
        <thead>
          <tr>
            <th>Student ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Course</th>
            <th>Year</th>
            <th>Subject</th>
            <th>Teacher</th>
            <th>Marks</th>
            <th>Percentage</th>
          </tr>
        </thead>
        <tbody id="reportTableBody">
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
#app {
  max-width: 100vw !important;
  width: 100vw !important;
  padding: 0 !important;
  overflow-x: hidden !important;
}
</style>

<script type="module">
import { apiGetAll as apiGetAllStudents } from '/frontend/assets/js/services/studentService.js';
import { apiMarkGetAll } from '/frontend/assets/js/services/markService.js';
import { apiGetAll as apiGetAllTeachers } from '/frontend/assets/js/services/teacherService.js';

(async () => {
  const students = await apiGetAllStudents();
  const marks = await apiMarkGetAll();
  const teachers = await apiGetAllTeachers();

  const tbody = document.getElementById('reportTableBody');
  
  students.forEach(student => {
    const studentMarks = marks.filter(m => m.student_id === student.id);
    
    if (studentMarks.length === 0) {
      tbody.innerHTML += `
        <tr>
          <td>${student.id}</td>
          <td>${student.name}</td>
          <td>${student.email}</td>
          <td>${student.course}</td>
          <td>${student.year}</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>
      `;
    } else {
      const totalMarks = studentMarks.reduce((sum, m) => sum + m.marks, 0);
      const percentage = ((totalMarks / (studentMarks.length * 100)) * 100).toFixed(2);
      
      studentMarks.forEach(mark => {
        const teacher = teachers.find(t => t.subject === mark.subject);
        tbody.innerHTML += `
          <tr>
            <td>${student.id}</td>
            <td>${student.name}</td>
            <td>${student.email}</td>
            <td>${student.course}</td>
            <td>${student.year}</td>
            <td>${mark.subject}</td>
            <td>${teacher ? teacher.name : '-'}</td>
            <td>${mark.marks}</td>
            <td>${percentage}%</td>
          </tr>
        `;
      });
    }
  });
})();
</script>
